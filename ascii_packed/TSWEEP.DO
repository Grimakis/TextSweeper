1 CLEAR:VE$="2.6.0":CLS:DATA 30,00,70,35,78,35,120,22,1,146,139,119,35,120,22,225,130,120,60,155,119,35,121,22,1,146,139,119,35,121,22,249,130,121,60,155,119,201 ::DIMXY%(21):A%=0:FORN=0TO37:READA%:POKEVARPTR(XY%(3))+N,A%:NEXTN
6 DATA 1,0,0,17,8,32,112,35,113,35,4,120,186,218,6,8,6,0,12,121,187,218,6,8,201 ::DIMMA%(255):DIMMG%(12):FORN=0TO24:READA%:POKEVARPTR(MG%(0))+N,A%:NEXTN
8 DATA 0,17,0,32,213,30,255,71,87,62,1,78,35,35,129,122,206,0,87,12,121,198,255,123,206,0,95,184,122,194,45,8,225,114,201 ::DIMTS%(18):FORN=0TO34:READA%:POKEVARPTR(TS%(0))+N,A%:NEXTN:YO%=40:IFPEEK(1)<>171ANDPEEK(63035)=8THENLD%=0:H$="  [H]elp":GOTO14
11 IF(PEEK(1)<>171ANDPEEK(63035)=25)OR(PEEK(1)=171ANDPEEK(61190)=25)THENPO%=640ELSEPO%=320
12 IF(PEEK(1)<>171ANDPEEK(63036)=80)OR(PEEK(1)=171ANDPEEK(61191)=80)THENYO%=80:PO%=1280
13 LD%=1:H$="        "
14 GOSUB122:GOTO73
15 GOSUB106
16 FORN=0TO50:KEY(8)ON:IFN=0THENPRINT@Y*YO%+X,CN$;ELSEIFN=25THENPRINT@Y*YO%+X,CF$;ELSEPRINT"";
18 IFPEEK(65339)<>72ANDLD%<>1THENPRINTCHR$(27)+"U":GOSUB104
19 ONINSTR(1,S$,INKEY$)GOTO20,22,23,24,25,26,26,29,29,25,25,23,23,24,24,22,22,117,117
20 NEXTN:GOTO16
21 IFMC%=0THENME$(1)="    WIN!":GOTO71ELSE15
22 IFX<31THENX=X+1:GOTO16ELSE16
23 IFX>0THENX=X-1:GOTO16ELSE16
24 IFY<7THENY=Y+1:GOTO16ELSE16
25 IFY>0THENY=Y-1:GOTO16ELSE16
26 IFS%(X,Y,1)=0THENS%(X,Y,1)=1:PRINTCHR$(255);:GOTO16
27 IFS%(X,Y,1)=1THENS%(X,Y,1)=0:PRINTCHR$(239);:GOTO16
28 GOTO16
29 GOSUB122:IFM=1THEN54
30 IFS%(X,Y,1)=1THEN16
31 PRINT@3*YO%+9,"PLACING MINES!";:N=0:MG%(7)=VARPTR(MG%(3)):MG%(11)=VARPTR(MG%(3)):CALLVARPTR(MG%(0)),0,VARPTR(MA%(0)):POKEVARPTR(XY%(0)),X:POKEVARPTR(XY%(0))+1,Y:CALLVARPTR(XY%(3)),0,VARPTR(XY%(0))
35 J%=0:FORTY%=PEEK(VARPTR(XY%(2)))TOPEEK(VARPTR(XY%(2))+1):FORTX%=PEEK(VARPTR(XY%(1)))TOPEEK(VARPTR(XY%(1))+1):MA%(32*TY%+TX%)=-1:J%=J%+1:NEXT:NEXT:SE=(-3600*VAL(RIGHT$(TIME$,2)))+(-60*VAL(MID$(TIME$,4,2)))-VAL(RIGHT$(TIME$,2)):DU=RND(SE):DU=RND(1)
40 FORN%=0TOMN%-1:I2%=0:I%=FIX(RND(1)*(256-J%)):J%=J%+1:TS%(15)=(VARPTR(TS%(0))+8):TS%(1)=VARPTR(I2%):CALLVARPTR(TS%(0)),I%,VARPTR(MA%(0)):TX%=PEEK(VARPTR(MA%(I2%))):TY%=PEEK(VARPTR(MA%(I2%))+1):S%(TX%,TY%,0)=1:MI%(N%,0)=TX%:MI%(N%,1)=TY%:MA%(I2%)=-1:NEXT
45 M=1:PRINT@3*YO%+9,"CALCULATING...";:FORN%=0TOMN%-1:CX%=MI%(N%,0):CY%=MI%(N%,1):POKEVARPTR(XY%(0)),CX%:POKEVARPTR(XY%(0))+1,CY%:CALLVARPTR(XY%(3)),0,VARPTR(XY%(0))
50 FORTY%=PEEK(VARPTR(XY%(2)))TOPEEK(VARPTR(XY%(2))+1):FORTX%=PEEK(VARPTR(XY%(1)))TOPEEK(VARPTR(XY%(1))+1):S%(TX%,TY%,2)=S%(TX%,TY%,2)+1:NEXT:NEXT:NEXT:PRINT@3*YO%+9,STRING$(14,239)
54 IFS%(X,Y,0)=2ANDS%(X,Y,2)>0THEN98
55 IFS%(X,Y,1)<>1ANDS%(X,Y,0)<>2THENST%(W%,0)=X:ST%(W%,1)=Y:W%=W%+1:S%(X,Y,1)=2ELSE16
56 CX%=ST%(R%,0):CY%=ST%(R%,1):R%=R%+1:IFS%(CX%,CY%,0)=1ORS%(CX%,CY%,0)=3THEN70ELSEMC%=MC%-1:S%(CX%,CY%,0)=2
58 C=S%(CX%,CY%,2):IFC=0THENPRINT@(CY%*YO%)+CX%,CHR$(32);:S%(CX%,CY%,1)=32:GOTO63
60 IFC>0THENPRINT@(CY%*YO%)+CX%,RIGHT$(STR$(C),1);:S%(CX%,CY%,1)=ASC(RIGHT$(STR$(C),1))
61 IFR%=W%THEN21
62 IFR%<W%THEN56
63 POKEVARPTR(XY%(0)),CX%:POKEVARPTR(XY%(0))+1,CY%:CALLVARPTR(XY%(3)),0,VARPTR(XY%(0)):N=VARPTR(XY%(2)):FORTY%=PEEK(N)TOPEEK(N+1):N=VARPTR(XY%(1)):FORTX%=PEEK(N)TOPEEK(N+1)
67 IFS%(TX%,TY%,0)<2THENST%(W%,0)=TX%:ST%(W%,1)=TY%:W%=W%+1:S%(TX%,TY%,0)=S%(TX%,TY%,0)+2
68 NEXT:NEXT:IFR%<W%GOTO56ELSE21
70 FORC=0TOMN%-1:PRINT@MI%(C,0)+MI%(C,1)*YO%,CHR$(42);:NEXT
71 FORN=0TO6:PRINT@(N*YO%)+32,ME$(N);:NEXT:KEY(8)STOP:GOSUB112:IFYN%=1THEN1ELSECLS:MENU
73 CLS:PRINTCHR$(27)+CHR$(85);:PRINT@2*YO%+14,"TEXT SWEEPER":PRINT@3*YO%+13,"BY G.M. RIMAKIS":PRINT@5*YO%+7,"Press [SPACEBAR] to start.":PRINT@7*YO%,"Ver. "+VE$;:S$="Q"+CHR$(32)
77 ONINSTR(1,S$,INKEY$)GOTO77,79:GOTO77
79 CLS:S$="Q"+CHR$(28)+CHR$(29)+CHR$(31)+CHR$(30)+CHR$(70)+CHR$(102)+CHR$(32)+CHR$(13)+"WwAaSsDdHh":CN$=CHR$(27)+CHR$(80):CF$=CHR$(27)+CHR$(81):GOSUB136:GOSUB122
81 N%=VAL(INKEY$):IFN%>5ORN%<1THEN81ELSEIFN%=5THEN83
82 MN%=ASC(MID$("!17'",N%,1))-3:GOTO85
83 CLS:INPUT"Enter number of mines. (10-217)";MN%:IFMN%<10ORMN%>217GOTO83
85 MC%=256-MN%:DIMS%(31,7,2):DIMST%(271,1):DIMMI%(MN%-1,1):DIMME$(6):ME$(0)="     YOU":ME$(1)="   LOSE!":ME$(2)="        ":ME$(3)="    Play":ME$(4)="  Again?":ME$(5)="   (Y/N)":ME$(6)=ME$(2):CLS:GOSUB105:FORY=0TO7:PRINT@Y*YO%,STRING$(32,239);:NEXT:X=16:Y=3
95 ONKEYGOSUB,,,,,,,121:IFLD%=1THENGOSUB123
97 GOTO15
98 POKEVARPTR(XY%(0)),X:POKEVARPTR(XY%(0))+1,Y:CALLVARPTR(XY%(3)),0,VARPTR(XY%(0)):FC%=0:W%=0:R%=0:FORN%=0TO1:FORTY%=PEEK(VARPTR(XY%(2)))TOPEEK(VARPTR(XY%(2))+1):FORTX%=PEEK(VARPTR(XY%(1)))TOPEEK(VARPTR(XY%(1))+1):IFN%=0ANDS%(TX%,TY%,1)=1THENFC%=FC%+1
101 IFN%=1ANDS%(TX%,TY%,0)<2ANDS%(TX%,TY%,1)<>1THENST%(W%,0)=TX%:ST%(W%,1)=TY%:W%=W%+1:S%(TX%,TY%,0)=S%(TX%,TY%,0)+2
102 NEXT:NEXT:IFFC%=S%(X,Y,2)THENNEXTN%ELSE16
103 IFW%<>0THEN56ELSE16
104 CLS:GOSUB105:GOSUB106:GOSUB107:RETURN
105 PRINT@0*YO%+32,"    TEXT";:PRINT@1*YO%+32," SWEEPER";:RETURN
106 PRINT@3*YO%+32," SQUARES";:PRINT@4*YO%+32,"   LEFT:";:PRINT@5*YO%+32,"        ";:PRINT@5*YO%+32,"    "+STR$(MC%);:PRINT@7*YO%+32,H$;:RETURN
107 GOSUB122:KEY(8)STOP:FORTY%=0TO7:LS$="":FORTX%=0TO31:IFS%(TX%,TY%,1)=1THENT$=CHR$(255)ELSET$=CHR$(239)
109 IFS%(TX%,TY%,0)>1THENT$=RIGHT$(STR$(S%(TX%,TY%,2)),1)
110 IFT$="0"THENT$=" "
111 LS$=LS$+T$:NEXTTX%:PRINT@YO%*TY%,LS$;:NEXTTY%:KEY(8)ON:RETURN
112 GOSUB122:A$=INKEY$:IFA$=""THENA$="Q"
114 IFA$="Y"ORA$="y"THENYN%=1:RETURN
115 IFA$="N"ORA$="n"THENYN%=0:RETURN
116 GOTO112
117 IFLD%<>1THENGOSUB123ELSE16
118 IFPEEK(65343)<>238THENPRINTCHR$(27)+"U":GOSUB123
119 A$=INKEY$:IFA$="H"ORA$="h"THEN120ELSE118
120 GOSUB104:GOTO16
121 GOSUB122:GOSUB133:KEY(8)STOP:PRINT@3*YO%+35,"Quit?";:PRINT@4*YO%+35,"(y/n)";:GOSUB112:KEY(8)ON:IFYN%=1THENCLS:MENUELSEGOSUB105:GOSUB106:RETURN
122 PRINTCF$:PRINTCHR$(27)+CHR$(86):RETURN
123 IFLD%<>1THENCLS
124 GOSUB122:KEY(8)STOP:PRINT@0*YO%+15+PO%,"Controls";:PRINT@1*YO%+PO%,CHR$(235)+STRING$(38,231)+CHR$(236);:PRINT@2*YO%+PO%,CHR$(233)+"Cursor:      [W][A][S][D]/"+"["+CHR$(152)+"]["+CHR$(155)+"]["+CHR$(153)+"]["+CHR$(154)+"]"+CHR$(234);
128 PRINT@3*YO%+PO%,CHR$(233)+"Check Tile:            [Space]/[Enter]"+CHR$(234);:PRINT@4*YO%+PO%,CHR$(233)+"Set/Unset Flag:                    [F]"+CHR$(234);
130 IFLD%<>1THENPRINT@5*YO%+PO%,CHR$(233)+"Help Menu / Return:                [H]"+CHR$(234);ELSEPRINT@5*YO%+PO%,CHR$(233);:PRINT@5*YO%+PO%+39,CHR$(234);
131 PRINT@6*YO%+PO%,CHR$(233)+"Exit to Menu:                     [F8]"+CHR$(234);:PRINT@7*YO%+PO%,CHR$(237)+STRING$(38,232)+CHR$(238);:KEY(8)ON:RETURN
133 FORTY=0TO7:PRINT@TY*YO%+32,STRING$(8,32);:NEXT:RETURN
136 CLS:PRINT@0*YO%+11,"Select Difficulty":PRINT@2*YO%+1,"1. Easy   (30)":PRINT@4*YO%+1,"2. Medium (46)":PRINT@6*YO%+1,"3. Hard   (52)":PRINT@2*YO%+21,"4. Classic (36)":PRINT@4*YO%+21,"5. Custom":RETURN
