1 CLEAR:VE$="2.7.2":CLS:IFPEEK(1)=51 ORPEEK(1)=167THENAL%=-832ELSEIFPEEK(1)=171THENAL%=-2128
2 YO%=40:IFPEEK(1)<>171 ANDPEEK(63035)=8THENLD%=0:H$="  [H]elp":GOTO6
3 IF(PEEK(1)<>171 ANDPEEK(63035)=25) OR(PEEK(1)=171 ANDPEEK(61190)=25)THENPO%=640ELSEPO%=320
4 IF(PEEK(1)<>171 ANDPEEK(63036)=80) OR(PEEK(1)=171 ANDPEEK(61191)=80)THENYO%=80:PO%=1280
5 LD%=1:H$="        
6 GOSUB77:IFLD%=0THENGOSUB80
7 GOSUB69:GOTO39
8 GOSUB53
9 FORN=0TO50:KEY(8)ON:IFN=0THENPRINT@Y*YO%+X,CN$;ELSEIFN=25THENPRINT@Y*YO%+X,CF$;ELSEPRINT"";
10 IFPEEK(65339)<>72 ANDLD%<>1THENPRINTCHR$(27)+"U":GOSUB54:GOSUB53
11 ONINSTR(1,S$,INKEY$)GOTO12,14,15,16,17,18,18,21,21,17,17,15,15,16,16,14,14,64,64
12 NEXTN:GOTO9
13 IFMC%=0THENME$(1)="    WIN!":GOTO38ELSE8
14 IFX<31THENX=X+1:GOTO9ELSE9
15 IFX>0THENX=X-1:GOTO9ELSE9
16 IFY<7THENY=Y+1:GOTO9ELSE9
17 IFY>0THENY=Y-1:GOTO9ELSE9
18 IFS%(X,Y,1)=0THENS%(X,Y,1)=1:PRINTCHR$(255);:GOTO9
19 IFS%(X,Y,1)=1THENS%(X,Y,1)=0:PRINTCHR$(239);:GOTO9
20 GOTO9
21 GOSUB69:IFM=1THEN28
22 IFS%(X,Y,1)=1THEN9
23 PRINT@3*YO%+9,"PLACING MINES!";:N=0:MG%(7)=VARPTR(MG%(3)):MG%(11)=VARPTR(MG%(3)):CALLVARPTR(MG%(0)),0,VARPTR(MA%(0)):POKEVARPTR(XY%(0)),X:POKEVARPTR(XY%(0))+1,Y:CALLVARPTR(XY%(3)),0,VARPTR(XY%(0))
24 J%=0:FORTY%=PEEK(VARPTR(XY%(2)))TOPEEK(VARPTR(XY%(2))+1):FORTX%=PEEK(VARPTR(XY%(1)))TOPEEK(VARPTR(XY%(1))+1):MA%(32*TY%+TX%)=-1:J%=J%+1:NEXT:NEXT:SE=(-3600*VAL(RIGHT$(TIME$,2)))+(-60*VAL(MID$(TIME$,4,2)))-VAL(RIGHT$(TIME$,2)):DU=RND(SE):DU=RND(1)
25 FORN%=0TOMN%-1:I2%=0:I%=FIX(RND(1)*(256-J%)):J%=J%+1:TS%(15)=(VARPTR(TS%(0))+8):TS%(1)=VARPTR(I2%):CALLVARPTR(TS%(0)),I%,VARPTR(MA%(0)):TX%=PEEK(VARPTR(MA%(I2%))):TY%=PEEK(VARPTR(MA%(I2%))+1)
26 S%(TX%,TY%,0)=1:MI%(N%,0)=TX%:MI%(N%,1)=TY%:MA%(I2%)=-1:NEXT:M=1:PRINT@3*YO%+9,"CALCULATING...";:FORN%=0TOMN%-1:CX%=MI%(N%,0):CY%=MI%(N%,1):POKEVARPTR(XY%(0)),CX%:POKEVARPTR(XY%(0))+1,CY%:CALLVARPTR(XY%(3)),0,VARPTR(XY%(0))
27 FORTY%=PEEK(VARPTR(XY%(2)))TOPEEK(VARPTR(XY%(2))+1):FORTX%=PEEK(VARPTR(XY%(1)))TOPEEK(VARPTR(XY%(1))+1):S%(TX%,TY%,2)=S%(TX%,TY%,2)+1:NEXT:NEXT:NEXT:PRINT@3*YO%+9,STRING$(14,239)
28 IFS%(X,Y,0)=2 ANDS%(X,Y,2)>0THEN48
29 IFS%(X,Y,1)<>1 ANDS%(X,Y,0)<>2THENPOKEAL%+W%,X:POKEAL%+W%+1,Y:W%=W%+2:S%(X,Y,1)=2ELSE9
30 W%=W%-2:CX%=PEEK(AL%+W%):CY%=PEEK(AL%+W%+1):IFS%(CX%,CY%,0)=1 ORS%(CX%,CY%,0)=3THEN37ELSEMC%=MC%-1:S%(CX%,CY%,0)=2
31 C=S%(CX%,CY%,2):IFC=0THENPRINT@(CY%*YO%)+CX%,CHR$(32);:S%(CX%,CY%,1)=32:GOTO34
32 IFC>0THENPRINT@(CY%*YO%)+CX%,RIGHT$(STR$(C),1);:S%(CX%,CY%,1)=ASC(RIGHT$(STR$(C),1))
33 IFW%=0THEN13ELSE30
34 POKEVARPTR(XY%(0)),CX%:POKEVARPTR(XY%(0))+1,CY%:CALLVARPTR(XY%(3)),0,VARPTR(XY%(0)):N=VARPTR(XY%(2)):FORTY%=PEEK(N)TOPEEK(N+1):N=VARPTR(XY%(1)):FORTX%=PEEK(N)TOPEEK(N+1)
35 IFS%(TX%,TY%,0)<2THENPOKEAL%+W%,TX%:POKEAL%+W%+1,TY%:W%=W%+2:S%(TX%,TY%,0)=S%(TX%,TY%,0)+2
36 NEXT:NEXT:IFW%<>0GOTO30ELSE13
37 FORC=0TOMN%-1:PRINT@MI%(C,0)+MI%(C,1)*YO%,CHR$(42);:NEXT
38 GOSUB75:FORN=0TO6:PRINT@(N*YO%)+32,ME$(N);:NEXT:KEY(8)STOP:GOSUB60:IFYN%=1THEN1ELSECLS:MENU
39 CLS:PRINTCHR$(27)+CHR$(85);:PRINT@2*YO%+14,"TEXT SWEEPER":PRINT@3*YO%+13,"BY G.M. RIMAKIS":PRINT@5*YO%+7,"Press [SPACEBAR] to start.":PRINT@7*YO%,"Ver. "+VE$;:S$="Q"+CHR$(32)
40 ONINSTR(1,S$,INKEY$)GOTO40,41:GOTO40
41 CLS:S$="Q"+CHR$(28)+CHR$(29)+CHR$(31)+CHR$(30)+CHR$(70)+CHR$(102)+CHR$(32)+CHR$(13)+"WwAaSsDdHh":CN$=CHR$(27)+CHR$(80):CF$=CHR$(27)+CHR$(81):GOSUB76:GOSUB69
42 N%=VAL(INKEY$):IFN%>5 ORN%<1THEN42ELSEIFN%=5THEN44
43 MN%=ASC(MID$("!17'",N%,1))-3:GOTO45
44 CLS:INPUT"Enter number of mines. (10-217)";MN%:IFMN%<10 ORMN%>217GOTO44
45 MC%=256-MN%:DIMS%(31,7,2):DIMMI%(MN%-1,1):DIMME$(6):ME$(0)="     YOU":ME$(1)="   LOSE!":ME$(2)="        ":ME$(3)="    Play":ME$(4)="  Again?":ME$(5)="   (Y/N)":ME$(6)=ME$(2):CLS:GOSUB52:FORY=0TO7:PRINT@Y*YO%,STRING$(32,239);:NEXT:X=16:Y=3
46 ONKEYGOSUB,,,,,,,68:IFLD%=1THENGOSUB70
47 GOTO8
48 POKEVARPTR(XY%(0)),X:POKEVARPTR(XY%(0))+1,Y:CALLVARPTR(XY%(3)),0,VARPTR(XY%(0)):FC%=0:W%=0:R%=0:FORN%=0TO1:FORTY%=PEEK(VARPTR(XY%(2)))TOPEEK(VARPTR(XY%(2))+1):FORTX%=PEEK(VARPTR(XY%(1)))TOPEEK(VARPTR(XY%(1))+1):IFN%=0 ANDS%(TX%,TY%,1)=1THENFC%=FC%+1
49 IFN%=1 ANDS%(TX%,TY%,0)<2 ANDS%(TX%,TY%,1)<>1THENPOKEAL%+W%,TX%:POKEAL%+W%+1,TY%:W%=W%+2:S%(TX%,TY%,0)=S%(TX%,TY%,0)+2
50 NEXT:NEXT:IFFC%=S%(X,Y,2)THENNEXTN%ELSE9
51 IFW%<>0THEN30ELSE9
52 PRINT@0*YO%+32,"    TEXT";:PRINT@1*YO%+32," SWEEPER";:RETURN
53 PRINT@3*YO%+32," SQUARES";:PRINT@4*YO%+32,"   LEFT:";:PRINT@5*YO%+32,"        ";:PRINT@5*YO%+32,"    "+STR$(MC%);:PRINT@7*YO%+32,H$;:RETURN
54 GOSUB69:KEY(8)STOP:LS$="":FORTX%=0TO31:IFS%(TX%,7,1)=1THENT%=255ELSET%=239
55 IFS%(TX%,7,0)>1THENT%=S%(TX%,7,2)
56 IFT%=0THENT%=ASC(" ")
57 LS$=LS$+CHR$(T%):NEXTTX%:PRINT@YO%*7,LS$;:KEY(8)ON:RETURN
58 CALL63211:CLS:RETURN
59 CLS:CALL63231:RETURN
60 GOSUB69:A$=INKEY$:IFA$=""THENA$="Q
61 IFA$="Y" ORA$="y"THENYN%=1:RETURN
62 IFA$="N" ORA$="n"THENYN%=0:RETURN
63 GOTO60
64 IFLD%<>1THENGOSUB70ELSE9
65 IFPEEK(65343)<>238THENPRINTCHR$(27)+"U":GOSUB71
66 A$=INKEY$:IFA$="H" ORA$="h"THEN67ELSE65
67 GOSUB59:GOTO9
68 GOSUB69:GOSUB75:KEY(8)STOP:PRINT@3*YO%+35,"Quit?";:PRINT@4*YO%+35,"(y/n)";:GOSUB60:KEY(8)ON:IFYN%=1THENCLS:MENUELSEGOSUB52:GOSUB53:RETURN
69 PRINTCF$:PRINTCHR$(27)+CHR$(86):RETURN
70 IFLD%<>1THENGOSUB58
71 GOSUB69:KEY(8)STOP:PRINT@0*YO%+15+PO%,"Controls";:PRINT@1*YO%+PO%,CHR$(235)STRING$(38,231)CHR$(236);:PRINT@2*YO%+PO%,CHR$(233)"Cursor:      [W][A][S][D]/""["+CHR$(152)"]["CHR$(155)"]["CHR$(153)"]["CHR$(154)"]"CHR$(234);
72 PRINT@3*YO%+PO%,CHR$(233)"Check Tile:            [Space]/[Enter]"CHR$(234);:PRINT@4*YO%+PO%,CHR$(233)"Set/Unset Flag:                    [F]"CHR$(234);
73 IFLD%<>1THENPRINT@5*YO%+PO%,CHR$(233)"Help Menu / Return:                [H]"CHR$(234);ELSEPRINT@5*YO%+PO%,CHR$(233);:PRINT@5*YO%+PO%+39,CHR$(234);
74 PRINT@6*YO%+PO%,CHR$(233)+"Exit to Menu:                     [F8]"+CHR$(234);:PRINT@7*YO%+PO%,CHR$(237)STRING$(38,232)CHR$(238);:KEY(8)ON:RETURN
75 FORTY=0TO7:PRINT@TY*YO%+32,STRING$(8,32);:NEXT:RETURN
76 CLS:PRINT@0*YO%+11,"Select Difficulty":PRINT@2*YO%+1,"1. Easy   (30)":PRINT@4*YO%+1,"2. Medium (46)":PRINT@6*YO%+1,"3. Hard   (52)":PRINT@2*YO%+21,"4. Classic (36)":PRINT@4*YO%+21,"5. Custom":RETURN
77 DATA 30,00,70,35,78,35,120,22,1,146,139,119,35,120,22,225,130,120,60,155,119,35,121,22,1,146,139,119,35,121,22,249,130,121,60,155,119,201 :DIMXY%(21):A%=0:FORN=0TO37:READA%:POKEVARPTR(XY%(3))+N,A%:NEXTN
78 DATA 1,0,0,17,8,32,112,35,113,35,4,120,186,218,6,8,6,0,12,121,187,218,6,8,201 :DIMMA%(255):DIMMG%(12):FORN=0TO24:READA%:POKEVARPTR(MG%(0))+N,A%:NEXTN
79 DATA 0,17,0,32,213,30,255,71,87,62,1,78,35,35,129,122,206,0,87,12,121,198,255,123,206,0,95,184,122,194,45,8,225,114,201 :DIMTS%(18):FORN=0TO34:READA%:POKEVARPTR(TS%(0))+N,A%:NEXTN:RETURN
80 DATA 33,0,254,17,192,252,1,64,1,126,18,35,19,11,120,177,194,244,246,201 :FORN%=0TO19:READA%:POKE63211+N%,A%:NEXT:DATA 33,192,252,1,64,1,126,205,68,75,35,11,120,177,194,5,247,201 :FORN%=0TO17:READA%:POKE63231+N%,A%:NEXT:RETURN
